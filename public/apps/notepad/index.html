<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Notepad</title>
  <style>
    body {
      margin: 0;
      padding: 10px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    .toolbar {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      padding: 8px;
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .toolbar button {
      background: rgba(255, 255, 255, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }
    
    .toolbar button:hover {
      background: rgba(255, 255, 255, 0.35);
      transform: translateY(-1px);
    }
    
    .char-count {
      color: rgba(255, 255, 255, 0.9);
      font-size: 12px;
      margin-left: auto;
    }
    
    #notepad {
      flex: 1;
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 14px;
      resize: none;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    #notepad:focus {
      outline: 2px solid rgba(255, 255, 255, 0.5);
    }
    
    .status {
      margin-top: 8px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 11px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <button onclick="clearNote()">üóëÔ∏è Clear</button>
    <button onclick="insertTimestamp()">üïê Timestamp</button>
    <span class="char-count" id="charCount">0 characters</span>
  </div>
  
  <textarea id="notepad" placeholder="Start typing... Your notes will be saved automatically and restored when you refresh the page!"></textarea>
  
  <div class="status" id="status">‚úì Session state enabled - your notes persist across refreshes!</div>
  
  <script>
    const notepad = document.getElementById('notepad');
    const charCount = document.getElementById('charCount');
    const status = document.getElementById('status');
    
    // Update character count
    notepad.addEventListener('input', () => {
      const count = notepad.value.length;
      charCount.textContent = `${count} character${count !== 1 ? 's' : ''}`;
    });
    
    // Clear note
    function clearNote() {
      if (confirm('Clear all content?')) {
        notepad.value = '';
        charCount.textContent = '0 characters';
      }
    }
    
    // Insert timestamp
    function insertTimestamp() {
      const timestamp = new Date().toLocaleString();
      const pos = notepad.selectionStart;
      const text = notepad.value;
      notepad.value = text.slice(0, pos) + `[${timestamp}] ` + text.slice(pos);
      notepad.focus();
      notepad.setSelectionRange(pos + timestamp.length + 3, pos + timestamp.length + 3);
    }
    
    // ==========================================
    // SESSION STATE API IMPLEMENTATION
    // ==========================================
    
    // Save state function - called when page is about to refresh
    window.getAppSessionState = function() {
      console.log('üíæ Saving notepad state...');
      return {
        content: notepad.value,
        cursorPosition: notepad.selectionStart,
        scrollPosition: notepad.scrollTop
      };
    };
    
    // Restore state function - called after page loads with saved state
    window.restoreAppSessionState = function(state) {
      if (!state) {
        console.log('‚ÑπÔ∏è No previous state to restore');
        return;
      }
      
      console.log('üìÇ Restoring notepad state...', state);
      
      // Restore content
      if (state.content) {
        notepad.value = state.content;
        charCount.textContent = `${state.content.length} character${state.content.length !== 1 ? 's' : ''}`;
      }
      
      // Restore cursor position
      if (state.cursorPosition !== undefined) {
        setTimeout(() => {
          notepad.focus();
          notepad.setSelectionRange(state.cursorPosition, state.cursorPosition);
        }, 10);
      }
      
      // Restore scroll position
      if (state.scrollPosition !== undefined) {
        setTimeout(() => {
          notepad.scrollTop = state.scrollPosition;
        }, 20);
      }
      
      // Show restored message
      status.textContent = '‚úì Session restored successfully!';
      status.style.color = '#4ade80';
      setTimeout(() => {
        status.textContent = '‚úì Session state enabled - your notes persist across refreshes!';
        status.style.color = 'rgba(255, 255, 255, 0.8)';
      }, 3000);
    };
    
    // Initialize character count on load
    charCount.textContent = `${notepad.value.length} characters`;
    
    console.log('üìù Notepad initialized with instance ID:', window.__instanceId);
  </script>
</body>
</html>
