<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Frutiger Aero OS</title>
  <link rel="stylesheet" href="/styles.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
  <div class="desktop">
    <div class="wallpaper"></div>
    <div class="overlay"></div>

    <!-- Taskbar -->
    <div class="taskbar">
      <div class="start-btn" id="startBtn">
        <span class="start-icon">⊞</span>
        <span class="start-text">Start</span>
      </div>

      <div class="taskbar-icons">
        <button class="task-icon" data-app="os" title="Download OS"><img src="/apps/os/icon.png" alt="OS" class="app-icon" style="width: 100%; height: 100%; object-fit: contain;" onload="validateIconSize(this)"></button>
        <button class="task-icon" data-app="software" title="Software Store"><img src="/apps/software/icon.png" alt="Software" class="app-icon" style="width: 100%; height: 100%; object-fit: contain;" onload="validateIconSize(this)"></button>
      </div>

      <div class="taskbar-right">
        <span class="clock" id="clock"></span>
      </div>
    </div>

    <!-- Start Menu -->
    <div class="start-menu" id="startMenu">
      <div class="start-menu-header">
        <div class="start-menu-title">Frutiger Aero</div>
        <button class="close-start" id="closeStart">✕</button>
      </div>
      <div class="start-menu-grid">
        <button class="start-tile" onclick="run('shutdown'); run('shutdown /s /t 0');">
          <div class="tile-icon"><img src="/apps/os/icon.png" class="app-icon" style="width: 100%; height: 100%; object-fit: contain;"></div>
          <div class="tile-title">Shutdown</div>
        </button>
      </div>
    </div>

    <!-- Window container -->
    <div class="window-container" id="windowContainer"></div>
  </div>

  <script>
    function validateIconSize(img) {
      const allowedSizes = [32, 64, 128, 256, 512];
      if (!allowedSizes.includes(img.naturalWidth) || img.naturalWidth !== img.naturalHeight) {
        console.warn(`Icon ${img.src} has invalid size ${img.naturalWidth}x${img.naturalHeight}. Allowed: 32x32, 64x64, 128x128, 256x256, 512x512`);
        img.style.display = 'none'; // hide invalid icons
      }
    }
  </script>

  <div id="uacOverlay" class="uac-overlay hidden">
    <div class="uac-modal">
      <h2>⚠️ System Permission Required</h2>

      <div id="uacPages"></div>

      <div class="uac-actions">
        <button class="btn" onclick="denyUAC()">Cancel</button>
        <button class="btn primary" onclick="approveUAC()">Allow</button>
      </div>
    </div>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script src="/app.js"></script>
  <canvas id="previewCanvas" style="display:none;"></canvas>
</body>
</html>
